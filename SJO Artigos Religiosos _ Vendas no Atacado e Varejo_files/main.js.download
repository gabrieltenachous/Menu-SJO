var Main={init:function(){var keyUpTimeout=null;if($(".instantSearch").keyup(function(e){_valInput=$(this),clearTimeout(keyUpTimeout),keyUpTimeout=setTimeout(function(){Main.instantSearch()},500)}),Main.scrollPage(),$(".ctrCarrinhoGeralArea").live("mouseenter",{url:"get_cart",area:".top-cart-view",loader:"#loaderbar"},Main.getHtml),$(document).mouseup(Main.closeSearch),$(document).keyup(Main.closeSearch),$(".instantSearch").focus(function(){$(".header-overlay").addClass("active"),$(".top-search-form").css("z-index","1000")}),$(".instantSearch").blur(function(){$(".header-overlay").removeClass("active")}),$(".main-result-search").mouseleave(function(){$(".header-overlay").removeClass("active"),$(".top-search-form").css("z-index","0")}),$(".top-cart, .float-cart").mouseenter(function(){$(".header-overlay").addClass("active"),$(this).css("z-index","1000")}),$(".top-cart, .float-cart").mouseleave(function(){$(".header-overlay").removeClass("active"),$(this).css("z-index","0")}),$(".bar-top .account-hover").mouseenter(function(){$(".header-overlay").addClass("active"),$(".bar-top").css("z-index","1000")}),$(".bar-top .account-hover").mouseleave(function(){$(".header-overlay").removeClass("active"),$(".bar-top").css("z-index","3")}),$(".top-menu").mouseenter(function(){$(".header-overlay-floating-bar").addClass("active"),$(".floating-bar").css("z-index","1000")}),$(".top-menu").mouseleave(function(){$(".header-overlay-floating-bar").removeClass("active"),$(".floating-bar").css("z-index","999")}),$(".main-menu .menu-category").mouseenter(function(){$(".header-overlay").addClass("active"),$(this).css("z-index","1000")}),$(".main-menu .menu-category").mouseleave(function(){$(".header-overlay").removeClass("active"),$(this).css("z-index","0")}),$(".ctrFormLoginLogarTop").live("submit",Main.loginFormSubmit),$(".lost-pass").bind("click",Main.toggleLoginTop),$(".open-window").bind("click",Main.openWindow),$(".login-button").live("click",Main.socialLogin),$(".top-menu-dropdown-submenu").css("left",$(".top-menu-dropdown").width()),$(".top-menu-dropdown li").on("hover",function(){$(this).find(".top-menu-dropdown-submenu").css("top",$(this).position().top),$(this).find(".top-menu-dropdown-subsubmenu").css("top",$(this).position().top)}),$(".top-menu-dropdown-submenu .with-sub").on("hover",function(){$(".top-menu-dropdown-subsubmenu").css("left",$(this).parents(".top-menu-dropdown-submenu").width())}),$(".speech").live("click",Main.speechSearch),Main.getNavHistory(),$("#refreshSugestions").live("click",Main.getNavHistory),$(".main-colors .cor-icon").live("click",Main.colorStageVitrine),$(".main-colors .cor-icon").live("click",Main.loadSizesVitrine),$(".main-sizes .size-item").live("click",Main.selectSizesVitrine),$(".ctrAddCartFast").live("click",Main.adicionaCarrinhoRapido),$(".ctrAddCartFast.unavailable").live("mouseover",function(){$(this).text("Avise-me")}),$(".vitrine .product").live("mouseover",Main.verifyButton),Main.doSlider(),$(".submenu.marcas")[0]){var left_sm=$(".submenu.marcas").closest("li").offset().left-$(".main-menu").offset().left;$(".submenu.marcas").css({left:"-"+left_sm+"px"})}$(".account-hover").on("mouseover",function(){$(".account",this).show()}).on("mouseout",function(e){$(e.target).is("input")||$(".account",this).hide()}),$(".top-account").on("mouseover",function(){$(".account",this).show()}).on("mouseout",function(e){$(e.target).is("input")||$(".account",this).hide()}),Main.backTop(),$("#backtop").click(Main.scrollTop)},backTop:function(){$(window).scroll(function(){$(this).scrollTop()>=500&&$(window).width()>=500?$("#backtop").fadeIn("fast",function(){$(this).hasClass("hidden-i")||$(this).attr("style","display: block !important")}):($(this).scrollTop()<500||$(window).width()<500)&&$("#backtop").fadeOut("fast",function(){$(this).attr("style","display: none !important")})})},scrollTop:function(){$("body, html").animate({scrollTop:0},700,"swing")},toggleLoginTop:function(){$(this).parents(".account").find(".ctrFormLoginLogarTop, .ctrFormLoginLembrarSenhaMiniFloat, .ctrFormLoginLembrarSenhaMini").slideToggle()},instantSearch:function(){termo=$(_valInput).val(),icon=$("#topForm .icon"),image=$("#topForm img"),input=$(_valInput).focus(),resultArea=$(_valInput).parent().children(".main-result-search"),""==termo||void 0==termo?resultArea.html("").hide():Plataforma.ajax({url:"/produto/busca_json?maxRows=4&group=produto&search="+termo,dataType:"JSON",beforeSend:function(){icon.addClass("active"),image.removeClass("hidden")},success:function(data){icon.removeClass("active"),image.addClass("hidden"),data.length>0?(resultArea.html(""),$.each(data,function(i,item){titulo=item.Produto.titulo.length>30?item.Produto.titulo.substr(0,30)+"...":item.Produto.titulo,imagem=item.ProdutosImagem.imagem.replace("/min","/lista"),classe=i>=99?" hidden":"",html="<div class='result-item"+classe+"'><a href='"+item.ProdutosEstoque.link_prod+"' class='transition result-lnk' title='"+titulo+"'><div class='img-area'><img src='"+imagem+"' title='"+titulo+"' alt='"+titulo+"' class='result-img' /></div><div class='result-title'>"+titulo+"</div><div class='result-value-content'><span class='discount-value'>"+(item.ProdutosEstoque.vlr_antigo_loja?"R$ "+item.ProdutosEstoque.vlr_antigo_loja:"")+"</span><span class='result-value'>"+item.ProdutosEstoque.vlr_atual_loja+"</span></div></a></div>",resultArea.append(html)}),resultArea.slideDown(100)):(resultArea.html("<div class='result-empty'>Sua busca não retornou nenhum resultado.</div>"),resultArea.slideDown(100))}})},closeSearch:function(e){var container=$(".result-search");container.is(e.target)||0!==container.has(e.target).length||container.html("").hide(),27==e.keyCode&&container.html("").hide()},loginFormSubmit:function(){if($this=$(this),$email=$this.find("[name=login_email_top]"),$cpf_cnpj=$this.find("[name=logar_cpf_cnpj]"),$senha=$this.find("[name=login_pass_top]"),params={},$email.length>0){if(0==Main.validaEmail($email.val()))return Plataforma.alert("Por favor preencha o e-mail corretamente."),$email.focus(),!1;params.email=$email.val()}else if($cpf_cnpj.length>0){if(""==$cpf_cnpj.val())return Plataforma.alert("Por favor preencha o CPF/CNPJ corretamente."),$cpf_cnpj.focus(),!1;params.cpf_cnpj=$cpf_cnpj.val()}return""==$senha.val()?(Plataforma.alert("Por favor preencha a sua senha."),$senha.focus(),!1):(params.senha=$senha.val(),Plataforma.ajax({url:"clientes/do_login",data:params,dataType:"json",success:function(ret){if("error"==ret.type)Plataforma.alertJSON(ret);else{if($("[name=logar_redirect_sucesso]").length>0)var url_redirect=$("[name=logar_redirect_sucesso]").val();else if(void 0!=ret.redirect_to)var url_redirect=ret.redirect_to;else var url_redirect="clientes/index";Plataforma.go(url_redirect,{parseURL:!1,parent:!0})}}}),!1)},cadastrarFormSubmit:function(){if($this=$(this),$email=$this.find("[name=cadastrar_email]"),params={},$email.length>0){if(0==PlataformaValida.email($email.val()))return Plataforma.alert("Por favor preencha o e-mail corretamente."),$email.focus(),!1;if($("[name=cadastrar_redirect_sucesso]").length>0)var emailCliente=$.toJSON({cliente_email:$email.val(),cliente_confirmar_email:$email.val()}),url_redirect="/redirects/redirect?redirect="+escape($("[name=cadastrar_redirect_sucesso]").val())+"&ctrclienteinput="+escape(emailCliente);else var url_redirect="javascript:void(0);";Plataforma.go(url_redirect,{parseURL:!0,parent:!0})}return!1},openWindow:function(){var windowSizeAttr=$(this).attr("data-dimension"),windowSize=windowSizeAttr.split("x"),url=$(this).attr("url");window.open(url,"","width="+windowSize[0]+", height="+windowSize[1]+", resizable=no")},socialLogin:function(){var windowSizeAttr=$(this).attr("data-dimensions"),windowSize=windowSizeAttr.split("x");window.open($(this).attr("data-url"),"","width="+windowSize[0]+", height="+windowSize[1]+", resizable=no")},validaEmail:function(str){return!(!/^[\w!#$%&'*+\/=?^`{|}~-]+(\.[\w!#$%&'*+\/=?^`{|}~-]+)*@(([\w-]+\.)+[A-Za-z]{2,6}|\[\d{1,3}(\.\d{1,3}){3}\])$/.test(str)||!str)},getHtml:function(e){var url=void 0!=e.data?e.data.url:e.url,area=void 0!=e.data?e.data.area:e.area;$(this).hasClass("block-request")||($(this).hasClass("ctrCarrinhoGeralArea")||$(this).addClass("block-request"),Plataforma.ajax({url:"/comuns/"+url,dataType:"html",timeout:15e3,beforeSend:function(){$(".loader").show().removeClass("hide-in")},error:function(){$(area).append("<div class='error radius'>Erro ao carregar.</div>").show(),Main.hideLoader()},success:function(result){result.length?$(area).html(result):$(area).html("<div class='error radius'>Ocorreu um erro ao carregar, recarregue a página por gentileza.</div>"),Main.hideLoader()}}))},hideLoader:function(){$(".loader").addClass("hide-in"),setTimeout(function(){$(".loader.main").hide()},500)},speechSearch:function(){var recognition=new webkitSpeechRecognition;recognition.lang="pt-BR",recognition.continuous=!0,recognition.interimResults=!0,recognition.onresult=function(e){},recognition.start()},doSlider:function(){var _windowWidth=$(window).width(),itemsLast=_windowWidth<=1024?3:4,itemsColorsSizes=_windowWidth<=1024?5:6,vitrine=$(".container-vitrine");$.each(vitrine,function(){$(this).find("li").length>4?($(this).find(".vitrine-container").jCarouselLite({btnPrev:$(".prev",$(this)),btnNext:$(".next",$(this)),vertical:!1,circular:!1,visible:itemsLast,easing:"swing",speed:300}),$(this).find(".next").removeClass("disabled")):$(this).find(".next").addClass("disabled")}),$(".main-colors .nav").each(function(){$(this).find(".cor-icon").length>itemsColorsSizes?($(this).parents(".main-colors").addClass("carousel-active"),$(this).bxSlider({touchEnabled:!1,pager:!1,infiniteLoop:!1,hideControlOnEnd:!0,slideWidth:230,slideMargin:10,maxSlides:itemsColorsSizes,moveSlides:1})):$(this).parents(".main-colors").removeClass("carousel-active")}),$(".main-sizes .nav").each(function(){$(this).find(".size-item").length>itemsColorsSizes?($(this).parents(".main-sizes").addClass("carousel-active"),$(this).bxSlider({touchEnabled:!1,pager:!1,infiniteLoop:!1,hideControlOnEnd:!0,slideWidth:230,slideMargin:10,maxSlides:itemsColorsSizes,moveSlides:1})):$(this).parents(".main-sizes").removeClass("carousel-active")}),$(".options-box").fadeIn("slow")},getNavHistory:function(){Main.getHtml({url:"get_nav_history",area:".nav-history"})},scrollPage:function(){$(window).scroll(function(){$(this).scrollTop()>$("header").height()?$(".floating-bar").addClass("open"):$(".floating-bar").removeClass("open")})},colorStageVitrine:function(){var $this=$(this),$colors=$this.parents(".main-colors").find(".nav"),$thisChosen=$this.parent(".cor-item"),$product=$this.parents(".product").find(".main-img-box"),$values=$product.nextAll(".values"),$button=$this.parents(".product").find(".btn-add-bag"),$actualLink=$this.attr("data-link"),$actualSrc=$this.attr("data-img"),$actualSrcOver=$this.attr("data-img-over"),$notationOld=$this.attr("data-valor-antigo").split(" ")[0],$notationCurrent=$this.attr("data-valor-atual").split(" ")[0],$actualValueOld="R$"==$notationOld?$this.attr("data-valor-antigo"):"R$ "+$this.attr("data-valor-antigo").replace(".",","),$actualValueCurrent="R$"==$notationCurrent?$this.attr("data-valor-atual"):"R$ "+$this.attr("data-valor-atual").replace(".",",");if($colors.find(".cor-item").length>0){$colors.find(".cor-item").removeClass("selected"),$thisChosen.addClass("selected"),$product.attr("href",$actualLink).find(".image").attr({src:$actualSrc,"data-src":$actualSrcOver}),$values.attr("href",$actualLink).find(".old-price").html($actualValueOld).next(".current-price").html($actualValueCurrent);var classText="R$ 0,00"==$actualValueOld?"old-price hidden":"old-price";$values.find(".old-price").removeClass().addClass(classText)}$button.removeClass("added unavailable").text("Adicionar à sacola").attr({title:"Adicionar à sacola","data-href":$actualLink,href:$actualLink})},loadSizesVitrine:function($this){var $this=$(this),idGrade=$this.attr("idgrade"),$product=$this.parents(".product"),$sizes=$product.find(".main-sizes");void 0!=idGrade&&$.isNumeric(idGrade)&&Plataforma.ajax({url:"/comuns/get_sizes?idestoque="+idGrade,type:"get",dataType:"html",timeout:15e3,beforeSend:function(){$sizes.fadeIn()},success:function(data){"error"==data.type||($sizes.html("<div/>"),$sizes.find("div").fadeOut(function(){$(this).fadeIn("last").append(data);var _listSizes={".main-sizes .nav":""};$.each(_listSizes,function(element,value){$(element).each(function(){1==$(this).find(".size-item").length&&$(this).find(".size-item:first-child .size-icon").html()==value&&$(this).find(".size-item:first-child").hide()})}),1==$(this).find(".size-item").length&&$(this).find(".size-item .size-icon").click();var $navigator=$sizes.find(".nav"),_windowWidth=$(window).width(),_limitItems=_windowWidth<=1024?5:6;$navigator.find(".size-item").length>_limitItems?($(this).parents(".main-sizes").addClass("carousel-active"),$navigator.bxSlider({touchEnabled:!1,pager:!1,infiniteLoop:!1,hideControlOnEnd:!0,slideWidth:230,slideMargin:10,maxSlides:_limitItems,moveSlides:1})):$(this).parents(".main-sizes").removeClass("carousel-active")}))}})},selectSizesVitrine:function(){var $this=$(this).find(".size-icon"),idgrade=$this.attr("idgrade"),unavailable=!1,$parent=$this.parent("div"),$parents=$parent.parents(".main-sizes"),$button=$this.parents(".options-box").find(".ctrAddCartFast"),$actualLink=$button.attr("data-href"),$mainImage=$parents.parent().find(".main-img-box");$parents.find("div").removeClass("selected"),$this.parent($parent).addClass("selected"),$parent.hasClass("unavailable")?($mainImage.addClass("unavailable"),unavailable=!0):$mainImage.removeClass("unavailable"),$button.attr({"data-idgrade":"",href:""}),$button.attr({"data-idgrade":idgrade,href:$actualLink+"?idgrade="+idgrade}),Main.checksAddedCart($parents,idgrade,unavailable)},checksAddedCart:function($parents,idgrade,unavailable){var idgrade=parseInt(idgrade),$btnAdd=$parents.parent().find(".ctrAddCartFast");Plataforma.ajax({url:"comuns/get_added_cart?idgrade="+idgrade,dataType:"json",success:function(ret){var ret=parseInt(ret),title={1:"Adicionado",2:"Tamanho indisponível",3:"Adicionar à sacola"};$btnAdd.removeClass("added unavailable"),ret===idgrade&&$.isNumeric(ret)?$btnAdd.addClass("added").text(title[1]).attr("title",title[1]):1==unavailable?$btnAdd.addClass("unavailable").text(title[2]).attr("title",title[2]):$btnAdd.text(title[3]).attr("title",title[3])}})},adicionaCarrinhoRapido:function(e){if(1==Plataforma.adicionaCarrinhoRapidoExecng)return!1;if($(this).hasClass("unavailable"))return!0;if($(this).hasClass("added"))return!1;if(1==$(this).attr("data-kit"))return!0;var $this=$(this),$parents=$this.prev(".main-sizes"),$cartQtd=$(".ctrCarrinhoGeralQtd, .float-qtd"),$cartQtdText=$(".ctrCarrinhoGeralItensTexto"),$cartValue=$(".ctrCarrinhoGeralValor");if(void 0!=$this.attr("data-idgrade"))var idgrade=$this.attr("data-idgrade");if(""==idgrade||0==idgrade||void 0==idgrade)return Plataforma.alert("Por favor escolha um tamanho!","error"),!1;Plataforma.adicionaCarrinhoRapidoExecng=!0,Plataforma.ajax({url:"carrinho/do_add?idgrade="+idgrade,dataType:"json",success:function(ret){"error"==ret.type?(Plataforma.alertJSON(ret),Plataforma.adicionaCarrinhoRapidoExecng=!1):(Plataforma.alertJSON(ret),$cartQtd.text(ret.itens),$cartQtdText.text(1==ret.itens?"item":"itens"),$cartValue.text(ret.subtotalMoeda),Plataforma.adicionaCarrinhoRapidoExecng=!1,Main.checksAddedCart($parents,idgrade))}}),e.preventDefault()},verifyButton:function(){$(this).find(".ctrAddCartFast").hasClass("added")&&$(this).find(".ctrAddCartFast").text("Adicionado")}};$(Main.init);